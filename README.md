<!-- 
  Tags: DevOps
  Label: ‚öôÔ∏è Dockerizada com CI/CD Automatizado.
  Description: Aplica√ß√£o Flask Dockerizada com CI/CD Automatizado
  path_hook: hookfigma.hook18
-->

# üöÄ Aplica√ß√£o Flask Dockerizada com CI/CD Automatizado

## üìñ Sobre o Projeto

Este projeto implementa uma aplica√ß√£o web moderna em Flask com frontend estiloso, empacotada em Docker e com pipeline de CI/CD totalmente automatizado usando GitHub Actions para deploy no Google Cloud Run.

### ‚ú® Caracter√≠sticas:
- **Frontend Responsivo** com design glassmorphism e anima√ß√µes suaves
- **Deploy Automatizado** via GitHub Actions
- **Containeriza√ß√£o** com Docker otimizado
- **Monitoramento** com health checks
- **Escalabilidade** autom√°tica no Cloud Run

---

## üéØ Demonstra√ß√£o

A aplica√ß√£o exibe:
- ‚úÖ Mensagem "Hello World" estilizada
- üïê Hora atual em tempo real (S√£o Paulo, Brasil)
- üì± Interface responsiva para dispositivos m√≥veis
- üé® Design moderno com efeitos visuais elegantes
- üîç Status do deploy e informa√ß√µes do sistema

---

## üé® Recursos do Frontend

### Design Moderno:
- **Glassmorphism**: Efeito de vidro transl√∫cido
- **Gradientes**: Fundo com degrad√™ elegante  
- **Anima√ß√µes**: Transi√ß√µes suaves e fade-in
- **Responsivo**: Adaptado para mobile e desktop
- **Tipografia**: Fontes modernas e leg√≠veis

### Funcionalidades:
- ‚è∞ **Rel√≥gio em Tempo Real**: Hora de S√£o Paulo
- üìÖ **Data Formatada**: Em portugu√™s brasileiro
- üåç **Timezone Info**: Fuso hor√°rio detalhado
- üíö **Status Indicator**: Confirma√ß√£o de deploy
- üì± **Mobile First**: Design otimizado para celulares

---
## üìÅ Estrutura do Projeto

```
my-flask-app-docker/
‚îú‚îÄ‚îÄ app.py                    # üêç Aplica√ß√£o Flask principal
‚îú‚îÄ‚îÄ requirements.txt          # üì¶ Depend√™ncias Python
‚îú‚îÄ‚îÄ Dockerfile               # üê≥ Configura√ß√£o Docker
‚îú‚îÄ‚îÄ README.md               # üìñ Documenta√ß√£o
‚îî‚îÄ‚îÄ .github/
    ‚îî‚îÄ‚îÄ workflows/
        ‚îî‚îÄ‚îÄ deploy.yml      # ‚öôÔ∏è Pipeline CI/CD
```

---

## üîß Pr√©-requisitos

### ‚òÅÔ∏è Google Cloud Platform (GCP)
- Conta ativa com billing habilitado
- Projeto criado (anote o `PROJECT_ID`)

### üêô GitHub
- Reposit√≥rio criado
- Acesso para configurar secrets

### üíª Desenvolvimento Local (Opcional)
- Docker Desktop
- Python 3.9+
- Git

---

## üìã Como Obter Vari√°veis do Google Cloud Platform

### üîç **Localizando Informa√ß√µes Essenciais do GCP**

#### **1Ô∏è‚É£ PROJECT_ID - ID do Projeto**

**M√©todo 1: Console Web**
1. Acesse [Google Cloud Console](https://console.cloud.google.com)
2. No topo da p√°gina, clique no **seletor de projeto**
3. Na janela que abrir, voc√™ ver√°:
   - **Nome do Projeto**: Ex: "Meu App Flask"
   - **ID do Projeto**: Ex: `meu-projeto-flask-123456` ‚úÖ **Esta √© a vari√°vel!**

**M√©todo 2: Cloud Shell/Terminal**
```bash
# Listar todos os projetos
gcloud projects list

# Ver projeto atual
gcloud config get-value project

# Definir projeto (se necess√°rio)
gcloud config set project SEU_PROJECT_ID
```

**M√©todo 3: URL do Console**
- Na URL do console: `https://console.cloud.google.com/home/dashboard?project=meu-projeto-123`
- O que vem ap√≥s `project=` √© seu PROJECT_ID ‚úÖ

#### **2Ô∏è‚É£ REGION - Regi√£o do Google Cloud**

**Regi√µes Mais Usadas no Brasil:**
```bash
# S√£o Paulo (recomendada para BR)
southamerica-east1

# Outras op√ß√µes pr√≥ximas
us-east1        # Virg√≠nia do Norte (boa lat√™ncia)
us-central1     # Iowa (padr√£o em muitos tutoriais)
```

**Ver todas as regi√µes dispon√≠veis:**
```bash
# Listar regi√µes do Cloud Run
gcloud run regions list

# Listar todas as regi√µes do GCP
gcloud compute regions list
```

#### **3Ô∏è‚É£ SERVICE_ACCOUNT_EMAIL - Email da Conta de Servi√ßo**

**Ap√≥s criar a Service Account:**
```bash
# Listar todas as service accounts
gcloud iam service-accounts list

# Formato padr√£o ser√°:
# github-actions-sa@SEU_PROJECT_ID.iam.gserviceaccount.com
```

**No Console Web:**
1. **IAM & Admin** ‚Üí **Service Accounts**
2. Encontre a conta criada (ex: "github-actions-sa")
3. O email estar√° na coluna **Email** ‚úÖ

#### **4Ô∏è‚É£ ARTIFACT_REGISTRY_URL - URL do Reposit√≥rio**

**Formato padr√£o:**
```
REGION-docker.pkg.dev/PROJECT_ID/REPOSITORY_NAME
```

**Exemplo real:**
```
us-central1-docker.pkg.dev/meu-projeto-123/my-flask-app
```

**Verificar no terminal:**
```bash
# Listar reposit√≥rios
gcloud artifacts repositories list

# Ver detalhes de um reposit√≥rio espec√≠fico
gcloud artifacts repositories describe REPOSITORY_NAME \
  --location=REGION
```

### üìä **Script para defini√ß√£o e Coleta de Vari√°veis**

Cole este script no **Google Cloud Shell** para obter todas as informa√ß√µes:

```bash
#!/bin/bash

echo "üîç COLETANDO INFORMA√á√ïES DO GCP..."
echo "=================================="

# Obter PROJECT_ID atual
PROJECT_ID=$(gcloud config get-value project)
echo "üìå PROJECT_ID: $PROJECT_ID"

# Obter regi√£o padr√£o (se configurada)
REGION=$(gcloud config get-value compute/region 2>/dev/null)
if [ -z "$REGION" ]; then
    REGION="us-central1"  # Padr√£o
fi
echo "üåç REGION: $REGION"

# Definir nomes padr√£o
SERVICE_ACCOUNT_NAME="github-actions-sa"
REPOSITORY_NAME="my-flask-app"
SERVICE_NAME="my-flask-app"

echo "üë§ SERVICE_ACCOUNT_EMAIL: $SERVICE_ACCOUNT_NAME@$PROJECT_ID.iam.gserviceaccount.com"
echo "üì¶ ARTIFACT_REGISTRY_URL: $REGION-docker.pkg.dev/$PROJECT_ID/$REPOSITORY_NAME"
echo "üê≥ REPOSITORY_NAME: $REPOSITORY_NAME"
echo "üöÄ SERVICE_NAME: $SERVICE_NAME"

echo ""
echo "=================================="
echo "‚úÖ INFORMA√á√ïES COLETADAS COM SUCESSO!"
echo ""
echo "üìù PR√ìXIMOS PASSOS:"
echo "1. Use PROJECT_ID como GitHub Secret: GCP_PROJECT_ID"
echo "2. Use as outras vari√°veis no arquivo .github/workflows/deploy.yml"
echo "=================================="
```
### üìä **Forma manual para defini√ß√£o**
```bash

üå± Definir vari√°veis (SUBSTITUA SEU_PROJECT_ID)
export PROJECT_ID="SEU_PROJECT_ID_AQUI"
export SERVICE_ACCOUNT_NAME="github-actions-sa"
export REGION="us-central1"
export REPOSITORY_NAME="my-flask-app"
echo "Projeto atual: $(gcloud config get-value project)"

```
---

## ‚ö° Configura√ß√£o R√°pida

### 1Ô∏è‚É£ **Configurar GCP (Cloud Shell)**

```bash

üîß Listar projetos dispon√≠veis e identificar projeto ativo
gcloud projects list
gcloud config get-value project

‚úÖ Configurar projeto
gcloud config set project $PROJECT_ID

üîß Verificar APIs habilitadas
gcloud services list \
  --enabled \
  --filter="name:(run.googleapis.com OR artifactregistry.googleapis.com)" \
  --format="value(name)"

‚úÖ Habilitar APIs necess√°rias
gcloud services enable run.googleapis.com \
  artifactregistry.googleapis.com \
  iam.googleapis.com \
  cloudbuild.googleapis.com

üîß Verificar Reposit√≥rio Artifact Registry existe
gcloud artifacts repositories list --format="table(name,location)"

‚úÖ Criar reposit√≥rio Artifact Registry
gcloud artifacts repositories create $REPOSITORY_NAME \
  --repository-format=docker \
  --location=$REGION \
  --description="Reposit√≥rio Docker para $REPOSITORY_NAME"

üîß Verificar todas Service Accounts que exitem
gcloud iam service-accounts list

üîß Verificar Service Account existe
gcloud iam service-accounts list --filter="email:github-actions-sa@*"

‚úÖ Criar Service Account
gcloud iam service-accounts create $SERVICE_ACCOUNT_NAME \
  --display-name="Service Account para GitHub Actions"

üîß Verificar Permiss√µes da Service Account
gcloud projects get-iam-policy $(gcloud config get-value project) \
  --flatten="bindings[].members" \
  --filter="bindings.members:serviceAccount:github-actions-sa@*" \
  --format="table(bindings.role)"

‚úÖ Conceder permiss√µes
gcloud projects add-iam-policy-binding $PROJECT_ID \
  --member="serviceAccount:$SERVICE_ACCOUNT_NAME@$PROJECT_ID.iam.gserviceaccount.com" \
  --role="roles/run.admin"

gcloud projects add-iam-policy-binding $PROJECT_ID \
  --member="serviceAccount:$SERVICE_ACCOUNT_NAME@$PROJECT_ID.iam.gserviceaccount.com" \
  --role="roles/artifactregistry.writer"

gcloud projects add-iam-policy-binding $PROJECT_ID \
  --member="serviceAccount:$SERVICE_ACCOUNT_NAME@$PROJECT_ID.iam.gserviceaccount.com" \
  --role="roles/iam.serviceAccountUser"

‚úÖ Gerar chave da Service Account
gcloud iam service-accounts keys create sa-key.json \
  --iam-account="$SERVICE_ACCOUNT_NAME@$PROJECT_ID.iam.gserviceaccount.com"

‚úÖ Exibir conte√∫do para copiar
echo "=== COPIE TODO O CONTE√öDO ABAIXO ==="
cat sa-key.json
```

### 2Ô∏è‚É£ **Configurar GitHub Secrets**

No seu reposit√≥rio GitHub:

1. **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
2. **New repository secret** e crie:

#### üîë **Secret 1:**
```
Name: GCP_SA_KEY
Value: [Cole todo o JSON do arquivo sa-key.json aqui]
```

#### üÜî **Secret 2:**
```
Name: GCP_PROJECT_ID  
Value: [Seu PROJECT_ID do GCP]
```

### 3Ô∏è‚É£ **Deploy Autom√°tico**

```bash
# Clone seu reposit√≥rio
git clone <URL_DO_SEU_REPOSITORIO>
cd my-flask-app-docker

# Adicione os arquivos do projeto
git add .
git commit -m "üöÄ Initial deploy to GCP Cloud Run"
git push origin main
```

üéâ **Pronto!** O GitHub Actions ser√° executado automaticamente e far√° o deploy.

---

## üßπ Limpeza de Recursos

Para evitar custos desnecess√°rios:

```bash
# Deletar servi√ßo Cloud Run
gcloud run services delete my-flask-app --region=us-central1

# Deletar reposit√≥rio Artifact Registry  
gcloud artifacts repositories delete my-flask-app --location=us-central1

# Deletar service account
gcloud iam service-accounts delete github-actions-sa@$PROJECT_ID.iam.gserviceaccount.com
```

---

## üîç Deploy do Pipeline CI/CD -  Actions GitHub
```bash
git checkout gcp-deploy
git merge <sua-branch-de-trabalho>
git push origin gcp-deploy
```

---

## üîç Verifica√ß√£o do Deploy

### Via Google Cloud Console:
1. Acesse [Cloud Run](https://console.cloud.google.com/run)
2. Encontre o servi√ßo `my-flask-app`
3. Clique na URL fornecida

### Via Command Line:
```bash
# Listar servi√ßos
gcloud run services list --region=us-central1

# Ver logs
gcloud run services logs read my-flask-app --region=us-central1
```

---

## üñ•Ô∏è Desenvolvimento Local

### Executar com Python:
```bash
# Criar ambiente virtual
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# Instalar depend√™ncias
pip install -r requirements.txt

# Executar aplica√ß√£o
python app.py
```

### Executar com Docker:
```bash
# Build da imagem
docker build -t my-flask-app .

# Executar container
docker run -p 5000:5000 -e PORT=5000 my-flask-app
```

Acesse: `http://localhost:5000`

---

## üìã Vari√°veis do Projeto

| Vari√°vel | Tipo | Onde Configurar | Exemplo |
|----------|------|-----------------|---------|
| `GCP_SA_KEY` | GitHub Secret | Repo Settings | `{json completo}` |
| `GCP_PROJECT_ID` | GitHub Secret | Repo Settings | `meu-projeto-123` |
| `REGION` | Workflow | `.github/workflows/deploy.yml` | `us-central1` |
| `SERVICE_NAME` | Workflow | `.github/workflows/deploy.yml` | `my-flask-app` |
| `REPOSITORY_NAME` | Workflow | `.github/workflows/deploy.yml` | `my-flask-app` |

---


## üîß Resolu√ß√£o de Problemas

### ‚ùå **Erro: "Permission Denied"**
```bash
# Verificar permiss√µes da service account
gcloud projects get-iam-policy $PROJECT_ID \
  --format="table(bindings.role)" \
  --filter="bindings.members:serviceAccount:github-actions-sa@$PROJECT_ID.iam.gserviceaccount.com"
```

### ‚ùå **Erro: "Repository Not Found"**
```bash
# Verificar se reposit√≥rio existe
gcloud artifacts repositories list --location=us-central1
```

### ‚ùå **Erro: "API Not Enabled"**
```bash
# Verificar APIs habilitadas
gcloud services list --enabled --filter="name:(run.googleapis.com OR artifactregistry.googleapis.com)"
```

### ‚ùå **Build Failed**
- Verifique se todos os arquivos est√£o no reposit√≥rio
- Confirme se os secrets est√£o configurados corretamente
- Veja os logs no GitHub Actions

### ‚ö†Ô∏è **Problemas com Vari√°veis do GCP**

**Erro: "Project not found"**
```bash

# Selecionar projeto correto
gcloud config set project SEU_PROJECT_ID_CORRETO
```

**Erro: "Service account not found"**
```bash

# Recriar se necess√°rio
gcloud iam service-accounts create github-actions-sa \
  --display-name="GitHub Actions Service Account"
```

**Erro: "Repository not found"**
```bash
# Verificar reposit√≥rios existentes
gcloud artifacts repositories list

# Criar reposit√≥rio se necess√°rio
gcloud artifacts repositories create my-flask-app \
  --repository-format=docker \
  --location=us-central1
```

---

## üí∞ Custos e Limites Gratuitos

### Google Cloud Run (Tier Gratuito):
- ‚úÖ **2 milh√µes** de requisi√ß√µes/m√™s
- ‚úÖ **180.000** vCPU-segundos/m√™s  
- ‚úÖ **360.000** GiB-segundos de mem√≥ria/m√™s
- ‚úÖ **1 GB** de largura de banda/m√™s

### Google Cloud (Novos Usu√°rios):
- üéÅ **$300 em cr√©ditos** para 90 dias
- üÜì **Always Free** tier para sempre

---


## üèóÔ∏è Pipeline CI/CD

### O que acontece no deploy:
1. üîç **Checkout**: Baixa c√≥digo do reposit√≥rio
2. üîê **Auth**: Autentica no Google Cloud
3. üê≥ **Build**: Constr√≥i imagem Docker
4. üì§ **Push**: Envia para Artifact Registry
5. üöÄ **Deploy**: Atualiza servi√ßo no Cloud Run
6. ‚úÖ **URL**: Exibe URL da aplica√ß√£o

### Triggers:
- ‚úÖ Push para branch `main`
- ‚úÖ Pull Request para `main`

---

## üí° **Dicas Importantes**

### **‚úÖ Boas Pr√°ticas:**
- **Sempre use** PROJECT_ID, nunca o nome do projeto
- **Mantenha consist√™ncia** nos nomes de reposit√≥rio e servi√ßo
- **Escolha uma regi√£o** e use sempre a mesma
- **Documente** as vari√°veis escolhidas para sua equipe

### **üîí Seguran√ßa:**
- **Nunca** exponha a chave JSON da service account
- **Use** GitHub Secrets para informa√ß√µes sens√≠veis
- **Limite** permiss√µes da service account ao m√≠nimo necess√°rio

### **üí∞ Custos:**
- **Prefira** regi√µes pr√≥ximas para reduzir lat√™ncia
- **Monitore** o uso no Google Cloud Console
- **Use** tier gratuito sempre que poss√≠vel

---

## ü§ù Contribui√ß√µes

Contribui√ß√µes s√£o bem-vindas! Para contribuir:

1. Fork o projeto
2. Crie uma branch: `git checkout -b feature/nova-funcionalidade`
3. Commit: `git commit -m "‚ú® Adiciona nova funcionalidade"`
4. Push: `git push origin feature/nova-funcionalidade`
5. Abra um Pull Request

---

## üìÑ Licen√ßa

Este projeto est√° sob licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para detalhes.

---

## üÜò Suporte

### Problemas Comuns:
- üìñ Consulte a se√ß√£o "Resolu√ß√£o de Problemas"
- üîç Veja os logs no GitHub Actions
- üìä Monitore no Google Cloud Console

### Precisa de Ajuda?
- üêõ Abra uma [Issue](../../issues)
- üí¨ Inicie uma [Discussion](../../discussions)
- üìß Entre em contato atrav√©s do GitHub
- üìñ **Documenta√ß√£o oficial**: [Google Cloud Docs](https://cloud.google.com/docs)
- üí¨ **Community**: [Google Cloud Community](https://cloud.google.com/community)
- üÜò **Stack Overflow**: Tag `google-cloud-platform`

---

**üéâ Projeto criado com Flask + Docker + GitHub Actions + Google Cloud Run**

*Desenvolvido com ‚ù§Ô∏è para demonstrar CI/CD moderno e eficiente*

## üë®‚Äçüíª Autor

[Fabiano Rocha/Fabiuniz]